<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ë”ê·¸ë€ë–¼ ë©”ë‰´ ê³„ì‚°ê¸°</title>
<style>
body { font-family: 'Arial', sans-serif; margin: 0; padding: 0; text-align: center; background: #fff; color: #333; }
header { background: #4caf50; color: white; padding: 15px 0; font-size: 22px; font-weight: bold; position: sticky; top: 0; z-index: 1000; }
.container { padding: 20px; }
h2 { margin-top: 30px; }
table { width:100%; max-width:700px; margin:auto; border-collapse: collapse; margin-bottom:20px; }
th, td { border:1px solid #ccc; padding:10px; text-align:center; }
th { background:#f1f1f1; }
input[type=number] { width:60px; padding:5px; border:1px solid #ccc; border-radius:6px; text-align:center; }
button { padding: 6px 12px; font-size: 14px; border: none; border-radius: 8px; background: #4caf50; color: white; cursor: pointer; transition: 0.2s; }
button:hover { background: #45a049; }
.delete-btn { background: #e53935; }
.delete-btn:hover { background: #d32f2f; }
.reset { margin-top: 20px; background: #e53935; }
.reset:hover { background: #d32f2f; }
#total { font-size: 20px; font-weight: bold; margin-top: 20px; }
.receipt, .history { margin-top: 30px; text-align: left; max-width: 500px; margin-left: auto; margin-right: auto; border: 1px solid #ccc; padding: 15px; border-radius: 10px; background: #f9f9f9; }
.receipt h2, .history h3 { text-align: center; }
.datetime { font-size: 14px; color: #555; text-align: center; margin-bottom: 10px; }
.category-title { font-weight: bold; margin-top: 10px; }
select { margin-top: 20px; padding: 10px; font-size: 16px; border-radius: 8px; }
.history-entry { border:1px solid #ddd; padding:10px; border-radius:8px; margin-bottom:10px; background:#fafafa; }
</style>
</head>
<body>
<header>ë”ê·¸ë€ë–¼ ë©”ë‰´ ê³„ì‚°ê¸°</header>
<div class="container">

<h2>ğŸ¥¤ ìŒë£Œ</h2>
<table id="drinkTable">
  <thead>
    <tr>
      <th>ë©”ë‰´</th>
      <th>+1</th>
      <th>ìˆ˜ëŸ‰ ì…ë ¥</th>
      <th>ì¶”ê°€</th>
      <th>-1</th>
    </tr>
  </thead>
  <tbody id="drinkBody"></tbody>
</table>

<h2>ğŸ° ë””ì €íŠ¸</h2>
<table id="dessertTable">
  <thead>
    <tr>
      <th>ë©”ë‰´</th>
      <th>+1</th>
      <th>ìˆ˜ëŸ‰ ì…ë ¥</th>
      <th>ì¶”ê°€</th>
      <th>-1</th>
    </tr>
  </thead>
  <tbody id="dessertBody"></tbody>
</table>

<div>
  <label for="membership">ë©¤ë²„ì‹­ ì„ íƒ: </label>
  <select id="membership">
    <option value="0">ì—†ìŒ</option>
    <option value="0.05">ë² ì´ì§ (5% í• ì¸)</option>
    <option value="0.10">í”ŒëŸ¬ìŠ¤ (10% í• ì¸)</option>
    <option value="0.12">í”„ë¡œ (12% í• ì¸)</option>
    <option value="0.15">í”„ë¦¬ë¯¸ì—„ (15% í• ì¸)</option>
    <option value="0.20">ì˜¤ë¦¬ì§„ (20% í• ì¸)</option>
    <option value="0.25">ì½”ì–´ (25% í• ì¸)</option>
    <option value="1.00">ì¸ë² ìŠ¤í„° (100% í• ì¸)</option>
  </select>
</div>

<div id="total">ì´ ê¸ˆì•¡: 0ì›</div>
<button class="reset" onclick="resetTotal()">ì´ˆê¸°í™”</button>
<button onclick="printReceipt()">ì˜ìˆ˜ì¦ ì¶œë ¥</button>
<button onclick="showHistory()">ì˜ìˆ˜ì¦ ê¸°ë¡ ë³´ê¸°</button>

<div id="receipt" class="receipt" style="display:none;">
  <h2>ì˜ìˆ˜ì¦</h2>
  <div class="datetime" id="receiptDate"></div>
  <div id="receiptList"></div>
  <p id="receiptTotal"></p>
  <p id="receiptDiscount"></p>
  <p id="receiptFinal"></p>
</div>

<div id="history" class="history" style="display:none;">
  <h3>ğŸ“œ ì˜ìˆ˜ì¦ ê¸°ë¡</h3>
  <div style="text-align:center; margin-bottom:10px;">
    <button onclick="deleteLastReceipt()">ìµœê·¼ ì˜ìˆ˜ì¦ ì‚­ì œ</button>
    <button class="reset" onclick="clearHistory()">ì „ì²´ ê¸°ë¡ ì‚­ì œ</button>
    <button onclick="undoDelete()">ë˜ëŒë¦¬ê¸°</button>
  </div>
  <div id="historyList"></div>
</div>

<script>
let total=0, items={}, lastDeleted=null;
const drinks=[
  {name:'ì•„ë©”ë¦¬ì¹´ë…¸', price:7500},
  {name:'ì¹´í˜ë¼ë–¼', price:5500},
  {name:'ë”¸ê¸°ë¼ë–¼', price:8000},
  {name:'ì—ìŠ¤í”„ë ˆì†Œ', price:8000},
  {name:'ì¹´ë¼ë©œ ë§ˆë¼ì•„ë˜', price:8000},
  {name:'ë¯¼íŠ¸ì´ˆì½”ë¼ë–¼', price:6000},
  {name:'ë ˆëª¬ì—ì´ë“œ', price:6000},
  {name:'ì•„ì´ìŠ¤í‹°', price:6000}
];
const desserts=[
  {name:'ì™€í”Œ', price:7000},
  {name:'í‹°ë¼ë¯¸ìˆ˜ ì¼€ì´í¬', price:7500},
  {name:'ì´ˆì½”ë¬´ìŠ¤ ì¼€ì´í¬', price:7500},
  {name:'ë§ˆì¹´ë¡±', price:6100},
  {name:'ìƒŒë“œìœ„ì¹˜', price:6900}
];

function renderMenu(){
  const drinkBody=document.getElementById('drinkBody');
  const dessertBody=document.getElementById('dessertBody');
  drinkBody.innerHTML=''; dessertBody.innerHTML='';
  drinks.forEach(d=>{
    let tr=document.createElement('tr');
    tr.innerHTML=`<td>${d.name} (${(d.price/1000).toFixed(1)})</td>
      <td><button onclick="addItem('${d.name}',${d.price},'ìŒë£Œ')">+1</button></td>
      <td><input type="number" id="qty-${d.name}" value="1" min="1"></td>
      <td><button onclick="addItemDirect('${d.name}',${d.price},'ìŒë£Œ')">ì¶”ê°€</button></td>
      <td><button onclick="removeItem('${d.name}')">-1</button></td>`;
    drinkBody.appendChild(tr);
  });
  desserts.forEach(d=>{
    let tr=document.createElement('tr');
    tr.innerHTML=`<td>${d.name} (${(d.price/1000).toFixed(1)})</td>
      <td><button onclick="addItem('${d.name}',${d.price},'ë””ì €íŠ¸')">+1</button></td>
      <td><input type="number" id="qty-${d.name}" value="1" min="1"></td>
      <td><button onclick="addItemDirect('${d.name}',${d.price},'ë””ì €íŠ¸')">ì¶”ê°€</button></td>
      <td><button onclick="removeItem('${d.name}')">-1</button></td>`;
    dessertBody.appendChild(tr);
  });
}

function addItem(name,price,category){
  if(items[name]) items[name].count++;
  else items[name]={price,count:1,category};
  total+=price;
  updateDisplay();
}

function addItemDirect(name,price,category){
  let qty=parseInt(document.getElementById("qty-"+name).value)||1;
  if(items[name]) items[name].count+=qty;
  else items[name]={price,count:qty,category};
  total+=price*qty;
  updateDisplay();
}

function removeItem(name){
  if(!items[name]) return;
  items[name].count--;
  total-=items[name].price;
  if(items[name].count<=0) delete items[name];
  updateDisplay();
}

function updateDisplay(){document.getElementById('total').innerText=`ì´ ê¸ˆì•¡: ${total.toLocaleString()}ì›`; }
function resetTotal(){total=0; items={}; updateDisplay(); document.getElementById('receipt').style.display='none';}

function printReceipt(){
  const now=new Date();
  const dateStr=now.toLocaleDateString('ko-KR');
  const timeStr=now.toLocaleTimeString('ko-KR');
  document.getElementById('receiptDate').innerText=`${dateStr} ${timeStr}`;
  let receiptList=document.getElementById('receiptList'); receiptList.innerHTML='';
  let categories={'ìŒë£Œ':[],'ë””ì €íŠ¸':[]};
  for(let item in items){
    let subtotal=items[item].price*items[item].count;
    categories[items[item].category].push(`${item} Ã— ${items[item].count} = ${subtotal.toLocaleString()}ì›`);
  }
  for(let cat in categories){
    if(categories[cat].length>0){
      let catTitle=document.createElement('p'); catTitle.className='category-title'; catTitle.innerText=`[${cat}]`;
      receiptList.appendChild(catTitle);
      let ul=document.createElement('ul');
      categories[cat].forEach(txt=>{let li=document.createElement('li'); li.textContent=txt; ul.appendChild(li);});
      receiptList.appendChild(ul);
    }
  }
  let membership=parseFloat(document.getElementById('membership').value);
  let discountAmount=total*membership;
  let finalTotal=total-discountAmount;
  document.getElementById('receiptTotal').innerText=`ì´ ê¸ˆì•¡: ${total.toLocaleString()}ì›`;
  document.getElementById('receiptDiscount').innerText=`í• ì¸ ê¸ˆì•¡: ${discountAmount.toLocaleString()}ì›`;
  document.getElementById('receiptFinal').innerText=`ìµœì¢… ê²°ì œ ê¸ˆì•¡: ${finalTotal.toLocaleString()}ì›`;
  document.getElementById('receipt').style.display='block';

  // ì˜ìˆ˜ì¦ ê¸°ë¡ ì €ì¥
  let history=JSON.parse(localStorage.getItem('receiptHistory')||'[]');
  history.push({date:`${dateStr} ${timeStr}`,items:Object.assign({},items),total,discountAmount,finalTotal});
  localStorage.setItem('receiptHistory',JSON.stringify(history));
}

function showHistory(){
  const historyDiv=document.getElementById('history');
  const historyList=document.getElementById('historyList'); historyList.innerHTML='';
  let history=JSON.parse(localStorage.getItem('receiptHistory')||'[]');
  if(history.length===0) historyList.innerHTML='<p>ì €ì¥ëœ ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
  else history.forEach(rec=>{
    let entry=document.createElement('div'); entry.className='history-entry';
    entry.innerHTML=`<strong>${rec.date}</strong><br>`;
    let categories={'ìŒë£Œ':[],'ë””ì €íŠ¸':[]};
    for(let item in rec.items){
      let subtotal=rec.items[item].price*rec.items[item].count;
      categories[rec.items[item].category].push(`${item} Ã— ${rec.items[item].count} = ${subtotal.toLocaleString()}ì›`);
    }
    for(let cat in categories){
      if(categories[cat].length>0) entry.innerHTML+=`<p>[${cat}]</p><ul>${categories[cat].map(x=>`<li>${x}</li>`).join('')}</ul>`;
    }
    entry.innerHTML+=`ì´ ê¸ˆì•¡: ${rec.total.toLocaleString()}ì›<br>í• ì¸ ê¸ˆì•¡: ${rec.discountAmount.toLocaleString()}ì›<br>ìµœì¢… ê²°ì œ ê¸ˆì•¡: ${rec.finalTotal.toLocaleString()}ì›`;
    historyList.appendChild(entry);
  });
  historyDiv.style.display='block';
}

function deleteLastReceipt(){
  let history=JSON.parse(localStorage.getItem('receiptHistory')||'[]');
  if(history.length===0){alert('ì‚­ì œí•  ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤.'); return;}
  lastDeleted=history.pop();
  localStorage.setItem('receiptHistory',JSON.stringify(history));
  showHistory();
  alert('ìµœê·¼ ì˜ìˆ˜ì¦ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë˜ëŒë¦¬ê¸°ë¥¼ ëˆŒëŸ¬ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
}

function clearHistory(){
  let history=JSON.parse(localStorage.getItem('receiptHistory')||'[]');
  if(history.length===0){alert('ì‚­ì œí•  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.'); return;}
  if(confirm('ì •ë§ ì „ì²´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
    lastDeleted=history;
    localStorage.removeItem('receiptHistory');
    showHistory();
    alert('ì „ì²´ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë˜ëŒë¦¬ê¸°ë¥¼ ëˆŒëŸ¬ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
  }
}

function undoDelete(){
  if(!lastDeleted){alert('ë˜ëŒë¦´ ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤.'); return;}
  let history=JSON.parse(localStorage.getItem('receiptHistory')||'[]');
  if(Array.isArray(lastDeleted)) history=history.concat(lastDeleted);
  else history.push(lastDeleted);
  localStorage.setItem('receiptHistory',JSON.stringify(history));
  lastDeleted=null;
  showHistory();
  alert('ì‚­ì œëœ ì˜ìˆ˜ì¦ì´ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

renderMenu();
</script>
</body>
</html>
